import "hash"

rule PupkinStealer_Malware {
  meta:
    description    = "Detects PupkinStealer malware based on known IoCs and file hashes"
    author         = "NA"
    date           = "2025-05-09"
    malware_family = "PupkinStealer"

  strings:
    // File path indicators
    $f1 = "%APPDATA%\\Temp\\*\\Grabbers\\Browser\\passwords.txt" nocase
    $f2 = "%APPDATA%\\Temp\\*\\Grabbers\\TelegramSession\\" nocase
    $f3 = "%APPDATA%\\Temp\\*\\Grabbers\\Discord\\Tokens.txt" nocase
    $f4 = "%APPDATA%\\Temp\\*\\Grabbers\\Screenshot\\Screen.jpg" nocase
    $f5 = "%APPDATA%\\Temp\\*\\DesktopFiles\\" nocase
    $f6 = "%APPDATA%\\Temp\\*\\*@ardent.zip" nocase

    // Telegram exfiltration URL
    $url1  = "https://api.telegram.org/bot" ascii wide
    $url2  = "/sendDocument?chat_id=7613862165&caption" ascii wide
    $token = "8013735771:AAE_UrTgQsAmiAsXeDN6mehD_fo3vEg-kCM" ascii wide

  condition:
    hash.sha256(0, filesize) == "9309003c245f94ba4ee52098dadbaa0d0a4d83b423d76c1bfc082a1c29e0b95f" or
    hash.md5(0, filesize) == "fc99a7ef8d7a2028ce73bf42d3a95bce" or

    // All Telegram-related strings (url1, url2, token) must be present together
    ($url1 and $url2 and $token) or

    // Match based on specific IoC strings (file paths)
    (4 of ($f*))
}
